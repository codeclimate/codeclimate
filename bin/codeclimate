#!/bin/sh
set -e

subcommand=${1:-help}; shift || true

case "$subcommand" in
  -h|--help|-?) subcommand=help ;;
  -v|--version) subcommand=version ;;
esac

root=$(cd "$(dirname "$0")"/.. && printf "%s" "$PWD")
subcommand_src=$root/codeclimate-$subcommand

if [ -d "$subcommand_src" ]; then
  exec "$subcommand_src/bin/run" "$@"
else
  # Fallback to legacy, monolithic executable
  exec "$root/bin/codeclimate-v1" "$subcommand" "$@"
fi
